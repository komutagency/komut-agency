<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KOM UT AGENCY</title>
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="KOM UT AGENCY — Agency for DJs." />
  <style>
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    :root{
      --bg:#000; --fg:#fff; --muted:#a9a9a9;
      --edge-d:24px; --edge-m:7px;
      --max:1200px;
      --ease:cubic-bezier(.2,.8,.2,1);
      --speed:260ms;
    }
    body{
      margin:0;background:#000;color:#fff;
      font-family:"Helvetica Neue", Helvetica, Arial, sans-serif;
      font-size:10px; text-transform:uppercase; letter-spacing:.02em;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    }
    button{background:none;border:none;color:inherit;font:inherit;cursor:pointer}
    a{color:inherit;text-decoration:none}

    main{flex:1;display:flex;align-items:stretch;justify-content:center;
      padding:140px var(--edge-d) 120px}
    .accordion{width:100%;max-width:var(--max);display:flex;flex-direction:column;gap:12px}

    .item{background:#050505}
    .summary{
      display:flex;align-items:center;justify-content:space-between;width:100%;
      padding:40px 0;transition:background var(--speed) var(--ease)
    }
    .summary .label{
      font-weight:800;font-size:10px;
      margin-right:auto; text-align:left; /* keep left edge */
    }
    .summary .hint{
      display:inline-block;width:24px;text-align:right;user-select:none
    }
    .summary:hover{background:#070707}

    /* Smooth open/close using explicit height transitions + slight opacity */
    .panel{
      height:0;overflow:hidden;opacity:0;will-change:height,opacity;
      transition:height var(--speed) var(--ease),opacity 220ms var(--ease)
    }
    .panel-inner{padding:0 0 var(--edge-d)}
    .item.open .panel{opacity:1}

    body.single-open .item{display:none}
    body.single-open .item.open{display:block}
    .item.open{min-height:60dvh}

    .tracks{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .track{display:flex;align-items:center}
    .playbtn{display:inline-grid;place-items:center;width:48px;height:48px}
    .playbtn svg{width:14px;height:14px}

    .booking-wrap{
      margin-top:18px;display:flex;justify-content:space-between;align-items:center
    }
    .booking-btn,.readmore-btn{padding:10px 0; font-weight:800}

    /* READ MORE exactly 100px below BOOK */
    .more{
      height:0;overflow:hidden;opacity:0;
      transition:height var(--speed) var(--ease),opacity 220ms var(--ease);
      margin-top:100px;
    }
    .more.open{opacity:1}
    .more-inner{
      padding:16px 0 0;
      display:grid;
      grid-template-columns:1fr 1fr; /* always 50/50 image/video */
      gap:12px;
      align-items:start;
    }
    .more-inner img{width:100%;height:auto;display:block;object-fit:cover}
    .video-wrap{position:relative}
    .video-wrap video{
      width:100%;height:100%;display:block;background:#000;object-fit:cover
    }
    /* hide native controls */
    .video-wrap video::-webkit-media-controls{display:none !important}

    /* Bottom bar */
    .bottom-bar{
      position:fixed;bottom:0;left:0;width:100%;
      display:grid;grid-template-columns:1fr auto 1fr;align-items:center;
      padding:10px var(--edge-d);z-index:120
    }
    .bottom-left{justify-self:start;display:flex;align-items:center}
    .bottom-center{justify-self:center}
    .bottom-right{justify-self:end}
    .chip{padding:0}
    .brand svg{width:130px;height:auto;display:block}

    .about{
      position:fixed;left:0;right:0;bottom:44px;max-height:0;overflow:hidden;background:#050505;
      transition:max-height var(--speed) var(--ease),opacity 200ms var(--ease);
      padding:0 var(--edge-d);opacity:0
    }
    .about.open{max-height:60dvh;padding:var(--edge-d);opacity:1}
    .about p{margin:0 0 10px 0}

    .modal{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;
      padding:var(--edge-d);z-index:80}
    .modal.open{display:flex}
    .dialog{background:#050505;width:min(720px,100%);padding:var(--edge-d)}
    .dialog-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    .dialog-title{font-weight:800}
    .close{font-size:10px;line-height:1;padding:6px 10px}
    .form{display:flex;flex-direction:column;gap:16px}
    .choices{display:flex;flex-wrap:wrap;gap:10px;margin-top:6px}
    .choice input{position:absolute;opacity:0;pointer-events:none}
    .choice label{display:inline-block;padding-top:7px; padding-bottom:7px; padding-right:16px;}
    .choice input:checked + label{outline:1px solid #fff;outline-offset:0;font-weight:800}
    textarea{width:100%;min-height:140px;background:#0a0a0a;color:#fff;border:1px solid #fff;border-radius:0;padding:12px;font-family:inherit;font-size:10px}
    .send{align-self:flex-start;padding:12px 18px;font-weight:800;margin-top:4px}

    /* Listening banner (TOP-RIGHT, always visible once selected) */
    .listen-banner{
      position:fixed;top:10px;right:var(--edge-d);z-index:130;
      display:none;gap:8px;align-items:center;letter-spacing:.03em
    }
    .listen-banner .label{font-weight:400} /* not bold */
    .listen-banner .mini-btn{
      font-size:10px;line-height:1;display:inline-grid;place-items:center;
      width:auto;height:auto;padding:0
    }

    @media (prefers-reduced-motion: reduce){
      .panel,.about,.more{transition:none}
      .summary{transition:none}
    }
  </style>
</head>
<body>
  <main>
    <div class="accordion" id="accordion">

      <!-- DJ CCCCCC -->
      <section class="item" data-artist="DJ CCCCCC">
        <button class="summary" aria-expanded="false">
          <span class="label">DJ CCCCCC</span>
          <span class="hint" aria-hidden="true"></span>
        </button>
        <div class="panel" aria-hidden="true">
          <div class="panel-inner">
            <div class="tracks" data-tracks='[
              {"src":"audio/ccc/track1.mp3"},
              {"src":"audio/ccc/track2.mp3"},
              {"src":"audio/ccc/track3.mp3"},
              {"src":"audio/ccc/track4.mp3"}
            ]'></div>
            <div class="booking-wrap">
              <button class="booking-btn" data-book-artist="DJ CCCCCC"><strong>BOOK DJ CCCCCC</strong></button>
              <button class="readmore-btn" data-more-target="#more-ccc">READ MORE</button>
            </div>
            <div class="more" id="more-ccc" aria-hidden="true">
              <div class="more-inner">
                <img src="images/ccc.jpg" alt="DJ CCCCCC" />
                <div class="video-wrap">
                  <video id="vid-ccc" src="video/ccc.mp4" muted loop playsinline></video>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SIMA -->
      <section class="item" data-artist="SIMA">
        <button class="summary" aria-expanded="false">
          <span class="label">SIMA</span>
          <span class="hint" aria-hidden="true"></span>
        </button>
        <div class="panel" aria-hidden="true">
          <div class="panel-inner">
            <div class="tracks" data-tracks='[
              {"src":"audio/sima/track1.mp3"},
              {"src":"audio/sima/track2.mp3"},
              {"src":"audio/sima/track3.mp3"}
            ]'></div>
            <div class="booking-wrap">
              <button class="booking-btn" data-book-artist="SIMA"><strong>BOOK SIMA</strong></button>
              <button class="readmore-btn" data-more-target="#more-sima">READ MORE</button>
            </div>
            <div class="more" id="more-sima" aria-hidden="true">
              <div class="more-inner">
                <img src="images/sima.jpg" alt="SIMA" />
                <div class="video-wrap">
                  <video id="vid-sima" src="video/sima.mp4" muted loop playsinline></video>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- MARTINA MENFORS -->
      <section class="item" data-artist="MARTINA MENFORS">
        <button class="summary" aria-expanded="false">
          <span class="label">MARTINA MENFORS</span>
          <span class="hint" aria-hidden="true"></span>
        </button>
        <div class="panel" aria-hidden="true">
          <div class="panel-inner">
            <div class="tracks" data-tracks='[
              {"src":"audio/martina/track1.mp3"},
              {"src":"audio/martina/track2.mp3"},
              {"src":"audio/martina/track3.mp3"}
            ]'></div>
            <div class="booking-wrap">
              <button class="booking-btn" data-book-artist="MARTINA MENFORS"><strong>BOOK MARTINA MENFORS</strong></button>
              <button class="readmore-btn" data-more-target="#more-martina">READ MORE</button>
            </div>
            <div class="more" id="more-martina" aria-hidden="true">
              <div class="more-inner">
                <img src="images/martina.jpg" alt="Martina Menfors" />
                <div class="video-wrap">
                  <video id="vid-martina" src="video/martina.mp4" muted loop playsinline></video>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- ABOUT drawer -->
  <aside class="about" id="aboutDrawer" aria-hidden="true">
    <p><strong>Kom Ut Agency</strong> represents producing artists who DJ — Our roster delivers raw, physical techno experiences built for spaces of intensity and endurance.</p>
    <p>Kjellmansgatan 32 · 0739443445</p>
    <p>Contact: komutagency@gmail.com</p>
  </aside>

  <!-- Listening banner (TOP-RIGHT, hidden by default; persists when paused) -->
  <div class="listen-banner" id="listenBanner">
    <span class="label" id="listenLabel">LISTENING TO:</span>
    <button class="mini-btn" id="listenToggle" aria-label="Toggle play/pause"></button>
  </div>

  <!-- Bottom bar -->
  <div class="bottom-bar">
    <div class="bottom-left brand">
      <svg viewBox="0 0 300 40" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <text x="0" y="28" fill="#fff" font-family="Helvetica, Arial, sans-serif" font-size="24" font-weight="800">KOM UT AGENCY</text>
      </svg>
    </div>
    <a href="mailto:komutagency@gmail.com" class="chip bottom-center">CONTACT</a>
    <button id="aboutBtn" class="chip bottom-right">ABOUT</button>
  </div>

  <!-- Booking modal -->
  <section class="modal" id="modal">
    <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="dialogTitle">
      <div class="dialog-header">
        <div class="dialog-title" id="dialogTitle">BOOKING</div>
        <button class="close" id="closeModal" aria-label="Close">×</button>
      </div>
      <form class="form" id="bookingForm">
        <input type="hidden" name="artist" id="artistField" />
        <div class="choices">
          <div class="choice">
            <input type="checkbox" id="opt1" name="purpose" value="Request Booking">
            <label for="opt1">Request Booking</label>
          </div>
          <div class="choice">
            <input type="checkbox" id="opt2" name="purpose" value="Demos">
            <label for="opt2">Demos</label>
          </div>
          <div class="choice">
            <input type="checkbox" id="opt3" name="purpose" value="Presskit">
            <label for="opt3">Presskit</label>
          </div>
        </div>
        <textarea id="message" placeholder="Message…"></textarea>
        <button type="submit" class="send">Send</button>
      </form>
    </div>
  </section>

  <script>
    // Icons
    const ICONS = {
      play: '<svg viewBox="0 0 24 24" fill="#fff" aria-hidden="true"><polygon points="6,4 20,12 6,20"/></svg>',
      pause:'<svg viewBox="0 0 24 24" fill="#fff" aria-hidden="true"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>',
      close:'×'
    };

    const accordion = document.getElementById('accordion');
    const body = document.body;

    function heightOpen(el){
      el.style.height = 'auto';
      const target = el.scrollHeight + 'px';
      el.style.height = '0px';
      requestAnimationFrame(()=>{ el.style.height = target; });
    }
    function heightClose(el){
      el.style.height = el.scrollHeight + 'px';
      requestAnimationFrame(()=>{ el.style.height = '0px'; });
    }

    function openItem(item){
      const panel = item.querySelector('.panel');
      document.querySelectorAll('.item.open').forEach(closeItem);
      heightOpen(panel);
      item.classList.add('open');
      panel.setAttribute('aria-hidden','false');
      body.classList.add('single-open');
      const hint = item.querySelector('.hint'); if(hint){ hint.textContent = ICONS.close; }
      const dur = getComputedStyle(panel).transitionDuration.split(',').map(s=>s.trim()).map(s=>{const v=parseFloat(s);return s.endsWith('ms')?v:v*1000;}).reduce((a,b)=>Math.max(a,b),0);
      setTimeout(()=>{ panel.style.height = 'auto'; }, dur);
      updateListenBanner();
    }
    function closeItem(item){
      const panel = item.querySelector('.panel');
      heightClose(panel);
      item.classList.remove('open');
      panel.setAttribute('aria-hidden','true');
      const hint = item.querySelector('.hint'); if(hint){ hint.textContent = ''; }
      updateListenBanner();
    }

    accordion.querySelectorAll('.item').forEach(item => {
      const summary = item.querySelector('.summary');
      const hint = item.querySelector('.hint');
      summary.addEventListener('click', () => {
        const isOpen = item.classList.contains('open');
        document.querySelectorAll('.item.open').forEach(closeItem);
        if(!isOpen){ openItem(item); } else { body.classList.remove('single-open'); updateListenBanner(); }
      });
      hint.addEventListener('click', (e)=>{ e.stopPropagation(); closeItem(item); body.classList.remove('single-open'); updateListenBanner(); });
    });

    // Minimal audio player: exclusive, loop, ~-6 dB via volume, pause/resume
    let currentAudio = null;
    let currentBtn = null;
    let currentArtist = ''; // persists even when paused (so banner stays)

    function makeTrackRow(track, artist){
      const row = document.createElement('div');
      row.className = 'track';
      const btn = document.createElement('button');
      btn.className = 'playbtn';
      btn.innerHTML = ICONS.play;

      const audio = new Audio(track.src);
      audio.preload = 'auto';
      audio.loop = true;
      audio.volume = 0.5; // ~ -6 dB

      btn.addEventListener('click', async () => {
        if (currentAudio && currentAudio !== audio) {
          currentAudio.pause();
          if (currentBtn) currentBtn.innerHTML = ICONS.play;
        }
        if (audio.paused) {
          try { await audio.play(); } catch(_) {}
          btn.innerHTML = ICONS.pause;
          currentAudio = audio; currentBtn = btn; currentArtist = artist;
        } else {
          audio.pause(); // do not clear currentArtist
          btn.innerHTML = ICONS.play;
          // keep currentAudio reference so banner toggle works
          currentAudio = audio; currentBtn = btn;
        }
        updateListenBanner();
      });

      audio.addEventListener('pause', updateListenBanner);
      audio.addEventListener('play',  updateListenBanner);

      row.addEventListener('contextmenu', e => e.preventDefault());
      row.appendChild(btn);
      return row;
    }

    document.querySelectorAll('.tracks').forEach(list => {
      const tracks = JSON.parse(list.getAttribute('data-tracks'));
      const artist = list.closest('.item')?.dataset.artist || '';
      tracks.forEach(t => list.appendChild(makeTrackRow(t, artist)));
    });

    // About toggle
    document.getElementById('aboutBtn').addEventListener('click', () => {
      document.getElementById('aboutDrawer').classList.toggle('open');
    });

    // Booking modal
    const modal = document.getElementById('modal');
    const closeModal = document.getElementById('closeModal');
    const bookingForm = document.getElementById('bookingForm');
    const artistField = document.getElementById('artistField');

    document.querySelectorAll('[data-book-artist]').forEach(btn => {
      btn.addEventListener('click', () => {
        artistField.value = btn.getAttribute('data-book-artist');
        document.getElementById('dialogTitle').textContent = `BOOKING — ${artistField.value}`;
        modal.classList.add('open');
      });
    });
    closeModal.addEventListener('click', () => modal.classList.remove('open'));
    modal.addEventListener('click', e => { if (e.target === modal) modal.classList.remove('open'); });

    bookingForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const artist = artistField.value || '';
      const selected = Array.from(bookingForm.querySelectorAll('input[name="purpose"]:checked')).map(i => i.value);
      const message = document.getElementById('message').value.trim();
      const subject = encodeURIComponent(`${artist} — ${selected.join(', ') || 'Booking'}`);
      const body = encodeURIComponent(message);
      window.location.href = `mailto:komutagency@gmail.com?subject=${subject}&body=${body}`;
      modal.classList.remove('open');
      bookingForm.reset();
    });

    // READ MORE toggles
    function heightOpenLocal(el){
      el.style.height = 'auto';
      const target = el.scrollHeight + 'px';
      el.style.height = '0px';
      requestAnimationFrame(()=>{ el.style.height = target; });
    }
    function heightCloseLocal(el){
      el.style.height = el.scrollHeight + 'px';
      requestAnimationFrame(()=>{ el.style.height = '0px'; });
    }
    document.querySelectorAll('.readmore-btn').forEach(btn=>{
      const targetSel = btn.getAttribute('data-more-target');
      const target = document.querySelector(targetSel);
      if(!target) return;
      btn.addEventListener('click', ()=>{
        const isOpen = target.classList.contains('open');
        if(!isOpen){
          heightOpenLocal(target);
          target.classList.add('open');
          target.setAttribute('aria-hidden','false');
          const dur = getComputedStyle(target).transitionDuration.split(',').map(s=>s.trim()).map(s=>{const v=parseFloat(s);return s.endsWith('ms')?v:v*1000;}).reduce((a,b)=>Math.max(a,b),0);
          setTimeout(()=>{ target.style.height = 'auto'; }, dur);
        } else {
          heightCloseLocal(target);
          target.classList.remove('open');
          target.setAttribute('aria-hidden','true');
        }
      });
    });

    // Video click to toggle play/pause (no icons, no controls)
    document.querySelectorAll('.video-wrap video').forEach(v=>{
      v.addEventListener('click', async ()=>{
        if (v.paused) { try{ await v.play(); }catch(_){/* ignore */} }
        else { v.pause(); }
      });
    });

    // Listening banner (TOP-RIGHT) logic: show once an artist has been selected (even if paused)
    const listenBanner = document.getElementById('listenBanner');
    const listenLabel  = document.getElementById('listenLabel');
    const listenToggle = document.getElementById('listenToggle');

    function updateListenBanner(){
      const hasSelection = !!currentArtist;
      listenBanner.style.display = hasSelection ? 'flex' : 'none';
      if (hasSelection){
        listenLabel.textContent = `LISTENING TO: ${currentArtist}`;
        if (currentAudio && !currentAudio.paused){
          listenToggle.innerHTML = ICONS.pause;
        } else {
          listenToggle.innerHTML = ICONS.play;
        }
      }
    }

    listenToggle.addEventListener('click', ()=>{
      if (!currentAudio) return;
      if (currentAudio.paused){ currentAudio.play(); }
      else { currentAudio.pause(); }
      updateListenBanner();
    });

  </script>
</body>
</html>
